<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burritos a Domicilio</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .order-btn-pulse {
            animation: pulse-ring 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
        }
        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(251, 191, 36, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(251, 191, 36, 0);
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

    <!-- Encabezado -->
    <header class="w-full max-w-2xl text-center mb-8">
        <h1 class="text-5xl md:text-6xl font-extrabold text-orange-600 drop-shadow-lg">Burritos </h1>
        <p class="text-xl text-gray-700 mt-2">隆Pide tus burritos favoritos por WhatsApp!</p>
    </header>

    <!-- Contenedor del men煤 -->
    <main id="menu-container" class="w-full max-w-4xl grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8 pb-[100px]">
        <!-- Los 铆tems del men煤 se renderizar谩n aqu铆 por JavaScript -->
    </main>

    <!-- Resumen del carrito -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t-2 border-orange-200 shadow-xl z-50">
        <div class="flex justify-between items-center max-w-4xl mx-auto">
            <div class="text-lg font-bold text-gray-800">
                Total: <span id="cart-total-display" class="text-orange-500">$0.00</span>
            </div>
            <button id="order-button"
                class="bg-orange-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-orange-600 transition-colors duration-300 transform scale-100 hover:scale-105 active:scale-95 order-btn-pulse">
                Pedir por WhatsApp
            </button>
        </div>
    </div>

    <!-- Modal para seleccionar y personalizar el producto -->
    <div id="product-details-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-[999] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm transform transition-transform duration-300 scale-95 md:scale-100">
            <h2 id="modal-product-name" class="text-2xl font-bold mb-4 text-center"></h2>
            <form id="product-details-form" class="space-y-4">
                <div>
                    <label for="quantity" class="block text-gray-700 font-medium">Cantidad:</label>
                    <input type="number" id="quantity" value="1" min="1" required
                        class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 px-3 py-2">
                </div>
                <div>
                    <label for="notes" class="block text-gray-700 font-medium">Notas especiales (ej. "Sin cebolla"):</label>
                    <textarea id="notes" rows="3"
                        class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 px-3 py-2"></textarea>
                </div>
                <button type="submit"
                    class="w-full bg-yellow-400 text-gray-900 font-bold py-3 rounded-md shadow-lg hover:bg-yellow-500 transition-colors duration-300">
                    Agregar al carrito
                </button>
            </form>
            <button id="close-product-modal-btn" class="mt-4 w-full bg-gray-200 text-gray-800 font-bold py-3 rounded-md hover:bg-gray-300 transition-colors duration-300">
                Cancelar
            </button>
        </div>
    </div>

    <!-- Modal para informaci贸n del cliente -->
    <div id="customer-info-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-[999] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm transform transition-transform duration-300 scale-95 md:scale-100">
            <h2 class="text-2xl font-bold mb-4 text-center">Detalles del pedido</h2>
            <form id="customer-info-form" class="space-y-4">
                <div>
                    <label for="customer-name" class="block text-gray-700 font-medium">Nombre:</label>
                    <input type="text" id="customer-name" required
                        class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 px-3 py-2">
                </div>
                <div>
                    <label for="delivery-address" class="block text-gray-700 font-medium">Direcci贸n de env铆o:</label>
                    <textarea id="delivery-address" rows="3" required
                        class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 px-3 py-2"></textarea>
                </div>
                <div>
                    <button type="button" id="get-location-btn" class="w-full bg-orange-400 text-white font-bold py-2 rounded-md hover:bg-orange-500 transition-colors duration-300">
                        Obtener mi ubicaci贸n
                    </button>
                    <p id="location-display" class="mt-2 text-center text-sm text-gray-600"></p>
                </div>
                <div>
                    <label for="payment-method" class="block text-gray-700 font-medium">Tipo de pago:</label>
                    <select id="payment-method" required
                        class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 px-3 py-2">
                        <option value="Efectivo">Efectivo</option>
                        <option value="Transferencia">Transferencia bancaria</option>
                    </select>
                </div>
                <!-- Campos de pago en efectivo, ocultos por defecto -->
                <div id="cash-payment-fields" class="space-y-4 hidden">
                    <div>
                        <label for="amount-paid" class="block text-gray-700 font-medium">Paga con:</label>
                        <input type="number" id="amount-paid" min="0"
                            class="mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-orange-500 focus:ring focus:ring-orange-200 focus:ring-opacity-50 px-3 py-2">
                    </div>
                    <div>
                        <p class="text-gray-700 font-medium">Cambio:</p>
                        <p id="change-display" class="mt-1 text-2xl font-bold text-green-600">$0.00</p>
                    </div>
                </div>
                <button type="submit"
                    class="w-full bg-orange-500 text-white font-bold py-3 rounded-md shadow-lg hover:bg-orange-600 transition-colors duration-300">
                    Confirmar y Enviar
                </button>
            </form>
            <button id="cancel-order-btn" class="mt-4 w-full bg-red-500 text-white font-bold py-3 rounded-md hover:bg-red-600 transition-colors duration-300">
                Cancelar Pedido
            </button>
            <button id="close-customer-modal-btn" class="mt-2 w-full bg-gray-200 text-gray-800 font-bold py-3 rounded-md hover:bg-gray-300 transition-colors duration-300">
                Volver
            </button>
        </div>
    </div>

    <script>
        // Definici贸n del men煤 de burritos
        const burritos = [
            {
                id: 1,
                name: "Burrito de Bistec",
                description: "Bistec marinado, cebollita cambray, nopal asado,frijoles caseros y queso mozarella.",
                price: 60.00,
                image: "images/vaca.png"
            },
            {
                id: 2,
                name: "Burrito de Longaniza",
                description: "Longaniza, cebollita cambray, nopal asado, frijoles caseros, queso mozarella.",
                price: 60.00,
                image: "images/cerdo.png"
            },
            {
                id: 3,
                name: "Burrito Campechano",
                description: "Bistec marinado combinado con longaniza, cebollita cambray, nopal asado, frijoles caseros y queso mozarella.",
                price: 60.00,
                image: "images/campechano.png"
            }
        ];

        let cart = []; // Array para almacenar los 铆tems del carrito: [{ id, name, price, quantity, notes }]
        let selectedBurrito = null;
        let customerLocation = null;

        const menuContainer = document.getElementById('menu-container');
        const cartTotalDisplay = document.getElementById('cart-total-display');
        const orderButton = document.getElementById('order-button');
        const productDetailsModal = document.getElementById('product-details-modal');
        const customerInfoModal = document.getElementById('customer-info-modal');
        const closeProductModalBtn = document.getElementById('close-product-modal-btn');
        const closeCustomerModalBtn = document.getElementById('close-customer-modal-btn');
        const productDetailsForm = document.getElementById('product-details-form');
        const customerInfoForm = document.getElementById('customer-info-form');
        const getLocationBtn = document.getElementById('get-location-btn');
        const locationDisplay = document.getElementById('location-display');
        
        // Nuevos elementos
        const cancelOrderBtn = document.getElementById('cancel-order-btn');
        const paymentMethodSelect = document.getElementById('payment-method');
        const cashPaymentFields = document.getElementById('cash-payment-fields');
        const amountPaidInput = document.getElementById('amount-paid');
        const changeDisplay = document.getElementById('change-display');

        // Funci贸n para renderizar el men煤
        function renderMenu() {
            menuContainer.innerHTML = '';
            burritos.forEach(burrito => {
                const burritoCard = document.createElement('div');
                burritoCard.className = 'bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden transform hover:scale-105 cursor-pointer';
                burritoCard.setAttribute('data-id', burrito.id);
                burritoCard.innerHTML = `
                    <img src="${burrito.image}" alt="${burrito.name}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <h3 class="text-2xl font-bold text-gray-900">${burrito.name}</h3>
                        <p class="text-gray-600 text-sm mt-1 mb-3">${burrito.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold text-orange-500">$${burrito.price.toFixed(2)}</span>
                            <button data-id="${burrito.id}"
                                class="add-to-cart-btn bg-yellow-400 text-gray-900 font-bold py-2 px-6 rounded-full shadow-md hover:bg-yellow-500 transition-colors duration-300">
                                Agregar
                            </button>
                        </div>
                    </div>
                `;
                menuContainer.appendChild(burritoCard);
            });
        }

        // Funci贸n para actualizar el total del carrito
        function updateCartTotal() {
            let total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartTotalDisplay.textContent = `$${total.toFixed(2)}`;
            orderButton.disabled = total === 0;
            // Actualizar el c谩lculo de cambio al cambiar el total del carrito
            calculateChange();
        }
        
        // Funci贸n para calcular y mostrar el cambio
        function calculateChange() {
            const total = parseFloat(cartTotalDisplay.textContent.replace('$', ''));
            const amountPaid = parseFloat(amountPaidInput.value);
            if (!isNaN(amountPaid) && amountPaid >= total) {
                const change = amountPaid - total;
                changeDisplay.textContent = `$${change.toFixed(2)}`;
                changeDisplay.classList.remove('text-red-600');
                changeDisplay.classList.add('text-green-600');
            } else if (!isNaN(amountPaid) && amountPaid < total) {
                const missing = total - amountPaid;
                changeDisplay.textContent = `Faltan: $${missing.toFixed(2)}`;
                changeDisplay.classList.remove('text-green-600');
                changeDisplay.classList.add('text-red-600');
            } else {
                changeDisplay.textContent = `$0.00`;
                changeDisplay.classList.remove('text-red-600');
                changeDisplay.classList.add('text-green-600');
            }
        }

        // Manejador de eventos para abrir el modal de detalles del producto
        menuContainer.addEventListener('click', (e) => {
            const card = e.target.closest('[data-id]');
            if (card) {
                const burritoId = parseInt(card.dataset.id);
                selectedBurrito = burritos.find(b => b.id === burritoId);
                if (selectedBurrito) {
                    document.getElementById('modal-product-name').textContent = selectedBurrito.name;
                    productDetailsModal.classList.remove('hidden');
                    productDetailsModal.classList.add('flex');
                }
            }
        });

        // Manejador para agregar producto al carrito desde el modal
        productDetailsForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const quantity = parseInt(document.getElementById('quantity').value);
            const notes = document.getElementById('notes').value.trim();
            if (quantity > 0) {
                cart.push({
                    ...selectedBurrito,
                    quantity: quantity,
                    notes: notes
                });
                updateCartTotal();
                productDetailsModal.classList.add('hidden');
                document.getElementById('quantity').value = 1;
                document.getElementById('notes').value = '';
            }
        });

        // Manejador para cerrar el modal de detalles del producto
        closeProductModalBtn.addEventListener('click', () => {
            productDetailsModal.classList.add('hidden');
            productDetailsModal.classList.remove('flex');
        });
        
        // Manejador del bot贸n de pedido
        orderButton.addEventListener('click', () => {
            if (cart.length > 0) {
                customerInfoModal.classList.remove('hidden');
                customerInfoModal.classList.add('flex');
            } else {
                 // Reemplazar alert() con un modal
                 const alertModal = document.createElement('div');
                 alertModal.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 z-[999] flex items-center justify-center p-4';
                 alertModal.innerHTML = `
                     <div class="bg-white p-6 rounded-2xl shadow-2xl text-center">
                         <p class="text-xl font-bold mb-4">Por favor, agrega al menos un burrito a tu carrito.</p>
                         <button class="bg-orange-500 text-white font-bold py-2 px-6 rounded-md hover:bg-orange-600 transition-colors duration-300" onclick="this.parentElement.parentElement.remove()">
                             Cerrar
                         </button>
                     </div>
                 `;
                 document.body.appendChild(alertModal);
            }
        });

        // Manejador para cerrar el modal de informaci贸n del cliente
        closeCustomerModalBtn.addEventListener('click', () => {
            customerInfoModal.classList.add('hidden');
            customerInfoModal.classList.remove('flex');
        });
        
        // Manejador para cancelar la orden y volver a la p谩gina principal
        cancelOrderBtn.addEventListener('click', () => {
            cart = [];
            updateCartTotal();
            customerInfoModal.classList.add('hidden');
            customerInfoModal.classList.remove('flex');
            // Limpiar los campos del formulario
            document.getElementById('customer-name').value = '';
            document.getElementById('delivery-address').value = '';
            amountPaidInput.value = '';
            locationDisplay.textContent = '';
            paymentMethodSelect.value = 'Efectivo';
            checkPaymentMethodVisibility(); // Llamada para asegurar que se restablece correctamente
        });

        // Manejador para obtener la ubicaci贸n del cliente
        getLocationBtn.addEventListener('click', () => {
            locationDisplay.textContent = 'Obteniendo ubicaci贸n...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        customerLocation = { lat, lon };
                        locationDisplay.textContent = `Ubicaci贸n obtenida: Lat ${lat.toFixed(4)}, Lon ${lon.toFixed(4)}`;
                    },
                    (error) => {
                        console.error('Error al obtener la ubicaci贸n:', error);
                        locationDisplay.textContent = 'No se pudo obtener la ubicaci贸n. Por favor, ingrese su direcci贸n manualmente.';
                        customerLocation = null;
                    }
                );
            } else {
                locationDisplay.textContent = 'Geolocalizaci贸n no es compatible con este navegador.';
                customerLocation = null;
            }
        });
        
        // Funci贸n para mostrar/ocultar los campos de pago en efectivo
        function checkPaymentMethodVisibility() {
            if (paymentMethodSelect.value === 'Efectivo') {
                cashPaymentFields.classList.remove('hidden');
            } else {
                cashPaymentFields.classList.add('hidden');
            }
        }
        
        // Manejador para mostrar/ocultar los campos de pago en efectivo
        paymentMethodSelect.addEventListener('change', checkPaymentMethodVisibility);
        
        // Manejador para calcular el cambio en tiempo real
        amountPaidInput.addEventListener('input', calculateChange);

        // Manejador para enviar el pedido por WhatsApp
        customerInfoForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const name = document.getElementById('customer-name').value;
            const address = document.getElementById('delivery-address').value;
            const paymentMethod = document.getElementById('payment-method').value;
            const total = cartTotalDisplay.textContent;

            let message = `隆Hola! Me gustar铆a hacer un pedido:\n\n`;
            message += `*Nombre:* ${name}\n`;
            message += `*Direcci贸n de env铆o:* ${address}\n`;
            message += `*Tipo de pago:* ${paymentMethod}\n\n`;

            // Agregar detalles de pago en efectivo si es el m茅todo seleccionado
            if (paymentMethod === 'Efectivo') {
                const amountPaid = amountPaidInput.value;
                const change = changeDisplay.textContent;
                message += `*Paga con:* $${parseFloat(amountPaid).toFixed(2)}\n`;
                message += `*Cambio:* ${change}\n\n`;
            }

            // Agregar enlace de Google Maps si la ubicaci贸n fue obtenida
            if (customerLocation) {
                const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${customerLocation.lat},${customerLocation.lon}`;
                message += `*Ubicaci贸n:* ${mapsUrl}\n\n`;
            }

            message += `*Detalles del pedido:*\n`;
            cart.forEach(item => {
                message += `- ${item.quantity} x ${item.name} ($${(item.price * item.quantity).toFixed(2)})\n`;
                if (item.notes) {
                    message += `  _Notas:_ ${item.notes}\n`;
                }
            });

            message += `\n*Total a pagar:* ${total}\n\n`;
            message += `隆Gracias!`;

            const encodedMessage = encodeURIComponent(message);
            // Reemplaza '1234567890' con tu n煤mero de tel茅fono de WhatsApp con el c贸digo de pa铆s.
            const whatsappUrl = `https://wa.me/527222396280?text=${encodedMessage}`;

            window.open(whatsappUrl, '_blank');
            
            // Cerrar modal y reiniciar estado
            customerInfoModal.classList.add('hidden');
            cart = [];
            updateCartTotal();
            customerLocation = null;
            document.getElementById('customer-name').value = '';
            document.getElementById('delivery-address').value = '';
            locationDisplay.textContent = '';
            checkPaymentMethodVisibility(); // Llamada para asegurar que se restablece correctamente
        });

        // Inicializar la aplicaci贸n
        renderMenu();
        updateCartTotal();
        checkPaymentMethodVisibility(); // Llamada inicial para mostrar los campos si 'Efectivo' est谩 seleccionado
    </script>
</body>
</html>

